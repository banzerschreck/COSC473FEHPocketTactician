<!DOCTYPE html>
<!--This page is where users are directed after receiving a confirmation email to confirm their email address-->
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="utf-8" />
  <title>Confirm Your Email</title>
  <script src="https://s3.amazonaws.com/stitch-sdks/js/bundles/4.3.2/stitch.js"></script>
  <script>
    function confirmEmail() {
      stitch.Stitch.initializeDefaultAppClient("473pockettactician-jcxsp");
      const url = window.location.search;
      const params = new URLSearchParams(url);
      const token = params.get('token');
      const tokenId = params.get('tokenId');
      const emailPassClient = stitch.Stitch.defaultAppClient.auth.getProviderClient(stitch.UserPasswordAuthProviderClient.factory);
      emailPassClient
        .confirmUser(token, tokenId)
        .then(() => displayResult('success'))
        .catch(err => displayResult('error', err))
    }
    
    function displayResult(res, err) {
      const message = document.getElementById("message");
      if(res === "success") {
        message.innerText = "Successfully confirmed your email, you may close this window."
      } else if(res === "error") {
        message.innerText = "Unable to register user, " + err;
      }
    }
  </script>
</head>
<body onload="confirmEmail()">
  <a href="./index.html"><input type="submit" value="Return"></a>
  <div id="message"></div>
</body>
</html>

<!--
https://docs.mongodb.com/stitch/getting-started/user-management/confirm-email/
-->